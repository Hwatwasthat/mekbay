<div class="multi-select-container corner-borders" [class.open]="isOpen()">
    <div class="display-area" (click)="toggleDropdown()">
        <span class="label">{{ label() }}</span>
        <div class="pills-container">
            <ng-container *ngIf="selectedOptions().length === 0">
                <span class="placeholder">Any</span>
            </ng-container>
            <span *ngFor="let option of selectedOptions()" 
                  class="pill"
                  [ngClass]="{
                    'pill-or': option.state === 'or',
                    'pill-and': option.state === 'and',
                    'pill-not': option.state === 'not'
                  }">
                {{ option.name }}    
                <button class="remove-pill" (click)="removeOption(option.name, $event)">&#10005;</button>
            </span>
        </div>
        <svg class="chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
        </svg>
    </div>

    <div class="options-dropdown framed-borders" *ngIf="isOpen()">
        <ng-container *ngIf="options().length > 20">
            <div class="filter-container" (click)="$event.stopPropagation()">
                <input 
                    #filterInput
                    type="text" 
                    class="filter-input" 
                    placeholder="Filter..."
                    [value]="filterText()"
                    (input)="onFilterInput($event)">
            </div>
        </ng-container>
        <div class="options-list">
            <label *ngFor="let option of filteredOptions(); trackBy: trackByName" 
                class="option-item"
                [class.unavailable]="option.available === false"
                [class.selected-single]="!multiselect() && isSelected(option.name)"
                (click)="!multiselect() ? onSingleSelect(option.name) : null"
                >
                <ng-container *ngIf="multiselect(); else singleSelect">
                    <input type="checkbox" [checked]="isSelected(option.name)" (change)="onOptionToggle(option.name)" />
                    <span class="custom-checkbox"
                        [ngClass]="{
                            'checkbox-or': multistate() && isSelected(option.name) === 'or',
                            'checkbox-and': multistate() && isSelected(option.name) === 'and',
                            'checkbox-not': multistate() && isSelected(option.name) === 'not',
                            'checked': !multistate() && isSelected(option.name)
                        }">
                        <ng-container *ngIf="multistate(); else normalCheck">
                            <ng-container [ngSwitch]="isSelected(option.name)">
                                <span *ngSwitchCase="'or'" class="checkbox-mark">&#10003;</span>
                                <span *ngSwitchCase="'and'" class="checkbox-mark">+</span>
                                <span *ngSwitchCase="'not'" class="checkbox-mark">&#10005;</span>
                            </ng-container>
                        </ng-container>
                        <ng-template #normalCheck>
                            <span *ngIf="isSelected(option.name)" class="checkbox-mark">&#10003;</span>
                        </ng-template>
                    </span>
                </ng-container>
                <ng-template #singleSelect></ng-template>
                <img *ngIf="option.img" [src]="option.img" class="option-img" alt="">
                <span>{{ option.name }}</span>
            </label>
            <div *ngIf="filteredOptions().length === 0 && options().length > 0" class="no-options">
                No matching options
            </div>
            <div *ngIf="options().length === 0" class="no-options">
                No options available
            </div>
        </div>
    </div>
</div>