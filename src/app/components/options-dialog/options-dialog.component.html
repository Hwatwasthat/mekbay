<base-dialog [tabs]="tabs" [activeTab]="activeTab()" (activeTabChange)="activeTab.set($event)">
    <div dialog-header>
        <div class="title">Options</div>
    </div>
    <div dialog-body>
        @if (activeTab() === 'General') {
            <div class="tab-content">
                <div class="option-row">
                    <label for="sheetsColor">Sheets color:</label>
                    <select id="sheetsColor" class="bt-select" [value]="optionsService.options().sheetsColor"
                        (change)="onSheetsColorChange($event)">
                        <option value="normal">Normal (default)</option>
                        <option value="night">Night mode</option>
                    </select>
                </div>
                <div class="option-row">
                    <label for="pickerStyle">Picker style:</label>
                    <select id="pickerStyle" class="bt-select" [value]="optionsService.options().pickerStyle"
                        (change)="onPickerStyleChange($event)">
                        <option value="default">Automatic (default)</option>
                        <option value="radial">Always Dial</option>
                        <option value="linear">Always Linear</option>
                    </select>
                </div>
                <div class="option-col">
                    <div class="option-row">
                        <label for="quickActions">Quick actions:</label>
                        <select id="quickActions" class="bt-select" [value]="optionsService.options().quickActions"
                            (change)="onQuickActionsChange($event)">
                            <option value="enabled">Enabled</option>
                            <option value="disabled">Disabled (default)</option>
                        </select>
                    </div>
                    <div class="description">
                        <p>Quick actions let you trigger the picker's default action with a single tap or click, without opening
                            the picker.</p>
                        <p>Examples: in the Critical Table, clicking an ammo slot reduces ammo by 1; clicking other critical
                            slots applies a critical hit.</p>
                    </div>
                </div>
                <hr>
                <div class="option-col">
                    <label for="userUuid">User Identifier:</label>
                    <div class="option-row">
                        <input #uuidInput id="userUuid" class="bt-input" [class.error]="!!userUuidError" type="text" [value]="userUuid()"
                            (focus)="selectAll($event)"
                            (keydown)="onUserUuidKeydown($event)" />
                        <button class="bt-button" (click)="onSetUuid(uuidInput.value)">APPLY</button>
                    </div>
                    @if (userUuidError) {<div class="error-msg">{{ userUuidError }}</div>}
                    <div class="description">
                        <p>The User Identifier is used for cloud saving and is autogenerated the first time the application is
                            started.</p>
                        <p>By setting the same ID on multiple devices, you can share your saved forces across them.</p>
                    </div>
                </div>
            </div>
        }
        <!-- Advanced options -->
        @if (activeTab() === 'Advanced') {
            <div class="tab-content">
                <div class="option-row">
                    <label for="canvasInput">Canvas input:</label>
                    <select id="canvasInput" class="bt-select" [value]="optionsService.options().canvasInput"
                        (change)="onCanvasInputChange($event)">
                        <option value="all">All</option>
                        <option value="pen">Pen only</option>
                        <option value="touch">Touch only</option>
                    </select>
                </div>
                <div class="option-row">
                    <span>Drawings stored: <strong>{{ formatBytes(canvasMemorySize()) }}</strong></span>
                    <button class="bt-button" (click)="onPurgeCanvas()">PURGE</button>
                </div>
                <div class="option-col">
                    <div class="option-row">
                        <span>Record sheets stored: <strong>{{ formatBytes(sheetCacheSize()) }}</strong></span>
                        <button class="bt-button" (click)="onPurgeCache()">PURGE</button>
                    </div>
                    <div class="description">
                        <p>MekBay caches record sheets locally to speed up loading times and for offline use.</p>
                        <p>Purging the cache will remove all stored sheets. They will be re-downloaded as needed.</p>
                    </div>
                </div>
            </div>
        }
        <!-- Debug options -->
        @if (activeTab() === 'Debug') {
            <div class="tab-content">
                <div class="option-col">
                    <div class="option-row">
                        <span>Event Logger</span>
                        <button class="bt-button" (click)="clearDebugLogs()">CLEAR</button>
                    </div>
                    <div class="description">
                        <p>Logs pointerdown, keydown, and click events globally while this dialog is open.</p>
                    </div>
                    <div style="overflow:auto;font-family:monospace;font-size:0.9em;">
                        <div *ngFor="let log of debugLogs()">{{ log }}</div>
                        @if (debugLogs().length === 0) {
                            <div style="color:#888;">No events logged yet.</div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
    <div dialog-footer>
        <button class="modal-btn bt-button" (click)="onClose()">DISMISS</button>
    </div>
</base-dialog>